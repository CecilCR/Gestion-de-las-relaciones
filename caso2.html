<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso 2: DataNova (Proyecto Aurora)</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; background: #f9fafb; color: #1f2937; padding-bottom: 50px; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 30px; }
        .btn { padding: 10px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; transition: all 0.2s; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-primary { background: #2563eb; color: white; }
        .btn-secondary { background: #7c3aed; color: white; }
        .btn-success { background: #16a34a; color: white; }
        .btn-danger { background: #dc2626; color: white; }
        .btn-gray { background: #6b7280; color: white; }
        .btn-outline { background: white; border: 1px solid #d1d5db; color: #374151; }
        .input, .textarea, .select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; margin-bottom: 10px; }
        .label { display: block; font-size: 12px; font-weight: 700; color: #4b5563; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #4f46e5, #0ea5e9); }
        .login-card { background: white; padding: 40px; border-radius: 16px; width: 100%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .edit-section { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .edit-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; color: #1e293b; display: flex; align-items: center; gap: 8px; }
        .question-editor { background: white; border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .question-editor-header { font-weight: bold; margin-bottom: 10px; color: #2563eb; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }
        .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .table th { text-align: left; padding: 12px; background: #f1f5f9; color: #64748b; font-size: 13px; font-weight: 700; }
        .table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 700; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .case-content { line-height: 1.6; color: #334155; white-space: pre-line; margin-bottom: 30px; padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .question-card { margin-bottom: 20px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px; }
        .option-label { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s; }
        .option-label:hover { background: #f8fafc; }
        .feedback-box { margin-top: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; font-size: 14px; font-style: italic; color: #64748b; }
        .correct-answer { color: #16a34a; font-weight: bold; margin-bottom: 5px; }
        .wrong-answer { color: #dc2626; font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- üîê CONFIGURACI√ìN DE SEGURIDAD ---
        const STUDENT_PASSWORD = "AURORA"; // <--- CONTRASE√ëA PARA LA CLASE

        // --- DATOS DEL CASO DATANOVA ---
        const DEFAULT_CASE = {
            title: "Caso: DataNova y el Proyecto Aurora",
            content: "DataNova es una empresa latinoamericana de soluciones tecnol√≥gicas que ha crecido r√°pidamente durante los √∫ltimos cinco a√±os. Para mantenerse competitiva frente al aumento de startups en la regi√≥n, la direcci√≥n decide lanzar ‚ÄúAurora‚Äù, un servicio de anal√≠tica predictiva que integrar√° datos de distintas industrias. Debido a su complejidad, se conforma un equipo intergeneracional con perfiles complementarios.\n\nEl equipo est√° formado por:\n- Marta (62 a√±os): Analista senior, met√≥dica y orientada a la documentaci√≥n.\n- Luis (45 a√±os): Jefe de proyecto, mediador y eficiente.\n- Camila (29 a√±os): UX, √°gil y de comunicaci√≥n informal.\n- Diego (23 a√±os): Programador junior, adaptable pero inexperto en pol√≠tica interna.\n\nDurante la fase inicial del proyecto, la empresa impulsa la modalidad h√≠brida. Sin embargo, el equipo enfrenta diferentes expectativas generacionales sobre el trabajo. Marta prefiere formalidad y an√°lisis previo. Camila y Diego buscan iteraci√≥n r√°pida y canales digitales. Luis intenta conciliar ambos mundos, notando que las tensiones son culturales y no solo t√©cnicas.\n\nA pesar de los roces, cuando logran sincronizarse, el proyecto avanza con fuerza gracias a la reducci√≥n de riesgos de Marta, la visi√≥n de Luis y la innovaci√≥n de los j√≥venes. El reto es transformar esta diversidad en un activo."
        };

        const DEFAULT_QUESTIONS = [
            { 
                id: 1, 
                type: 'multiple', 
                question: '¬øCu√°l es el principal desaf√≠o intergeneracional del caso?', 
                options: [
                    'Falta de recursos financieros.',                                       // √çndice 0
                    'Diferencias en ritmos, estilos de comunicaci√≥n y expectativas.',       // √çndice 1 (Correcta)
                    'Poca preparaci√≥n t√©cnica de los miembros j√≥venes.',                    // √çndice 2
                    'Exceso de supervisi√≥n por parte de la gerencia.'                       // √çndice 3
                ], 
                correct: 1, 
                feedback: 'El texto menciona expl√≠citamente diferencias en ritmos, percepci√≥n de autoridad y formas de comunicar desacuerdos.' 
            },
            { 
                id: 2, 
                type: 'multiple', 
                question: '¬øQu√© oportunidad puede aprovechar el equipo?', 
                options: [
                    'La uniformidad en las preferencias laborales.',                        // √çndice 0
                    'La complementariedad entre experiencia profunda y pensamiento innovador.', // √çndice 1 (Correcta)
                    'La posibilidad de delegar todo a la generaci√≥n m√°s joven.',            // √çndice 2
                    'Reducir las reuniones para evitar conflictos.'                         // √çndice 3
                ], 
                correct: 1, 
                feedback: 'El caso destaca que cuando se sincronizan, la experiencia de Marta reduce riesgos y la innovaci√≥n de Camila/Diego genera valor.' 
            },
            { 
                id: 3, 
                type: 'multiple', 
                question: '¬øCu√°l ser√≠a una acci√≥n efectiva de liderazgo para Luis?', 
                options: [
                    'Permitir que cada generaci√≥n trabaje por separado.',                   // √çndice 0
                    'Evitar intervenir para que los conflictos se resuelvan solos.',        // √çndice 1
                    'Establecer espacios de alineamiento y m√©todos h√≠bridos.',              // √çndice 2 (Correcta)
                    'Centralizar todas las decisiones en √©l.'                               // √çndice 3
                ], 
                correct: 2, 
                feedback: 'Luis debe integrar el rigor (Marta) con la agilidad (Camila/Diego) mediante un modelo de gesti√≥n h√≠brido.' 
            },
            { 
                id: 4, 
                type: 'truefalse', 
                question: 'V/F: Las tensiones del equipo son exclusivamente consecuencia de la diferencia de edades.', 
                options: [], 
                correct: false, 
                feedback: 'Falso. El caso menciona que las tensiones son tambi√©n culturales, de estilos de trabajo y percepci√≥n de autoridad, no solo biol√≥gicas.' 
            },
            { 
                id: 5, 
                type: 'short', 
                question: '¬øQu√© estrategia concreta propondr√≠as para fortalecer la colaboraci√≥n?', 
                correctAnswers: ['mentoring', 'mentor√≠a', 'feedback', 'comunicaci√≥n', 'h√≠brido', 'integraci√≥n', 'equipos mixtos', 'alineamiento'], 
                feedback: 'Estrategias como el mentoring inverso, acuerdos de comunicaci√≥n o sesiones de alineamiento cultural son respuestas v√°lidas.' 
            }
        ];

        // --- APLICACI√ìN PRINCIPAL ---
        const App = () => {
            const [view, setView] = useState('login');
            const [adminPassword, setAdminPassword] = useState('');
            const [inputStudentPass, setInputStudentPass] = useState('');
            const [studentName, setStudentName] = useState('');
            
            // Datos
            const [caseData, setCaseData] = useState(DEFAULT_CASE);
            const [questions, setQuestions] = useState(DEFAULT_QUESTIONS);
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [studentResults, setStudentResults] = useState([]);
            const [editMode, setEditMode] = useState(false);

            useEffect(() => {
                const savedRes = localStorage.getItem('student-results');
                if (savedRes) setStudentResults(JSON.parse(savedRes));
                const savedCase = localStorage.getItem('custom-case');
                if (savedCase) setCaseData(JSON.parse(savedCase));
                const savedQs = localStorage.getItem('custom-questions');
                if (savedQs) setQuestions(JSON.parse(savedQs));
            }, []);

            // --- FUNCIONES ---
            const saveChanges = () => {
                localStorage.setItem('custom-case', JSON.stringify(caseData));
                localStorage.setItem('custom-questions', JSON.stringify(questions));
                setEditMode(false);
                alert('‚úÖ Cambios guardados.');
            };

            const restoreDefaults = () => {
                if(confirm('¬øRestaurar todo?')) {
                    setCaseData(DEFAULT_CASE);
                    setQuestions(DEFAULT_QUESTIONS);
                    localStorage.removeItem('custom-case');
                    localStorage.removeItem('custom-questions');
                    setEditMode(false);
                }
            };
            
            const clearData = () => {
                if(confirm('¬øBorrar notas?')) {
                    setStudentResults([]);
                    localStorage.removeItem('student-results');
                }
            };

            const updateQ = (id, field, val) => setQuestions(questions.map(q => q.id === id ? {...q, [field]: val} : q));
            
            const updateOpt = (qId, idx, val) => {
                const newQs = questions.map(q => { if(q.id !== qId) return q; const n = [...q.options]; n[idx] = val; return {...q, options: n}; });
                setQuestions(newQs);
            };

            const submitExam = () => {
                if(questions.some(q => answers[q.id] === undefined)) return alert('Responde todas las preguntas.');
                const results = questions.map(q => {
                    let isCorrect = false;
                    if(q.type === 'multiple' || q.type === 'truefalse') isCorrect = answers[q.id] === q.correct;
                    if(q.type === 'short') isCorrect = q.correctAnswers.some(a => answers[q.id].toLowerCase().includes(a.toLowerCase()));
                    return { ...q, userAnswer: answers[q.id], correct: isCorrect };
                });
                const updated = [...studentResults, { name: studentName, date: new Date(), results }];
                setStudentResults(updated);
                localStorage.setItem('student-results', JSON.stringify(updated));
                setSubmitted(true);
            };

            const downloadCSV = () => {
                const csv = "Nombre,Nota\n" + studentResults.map(r => `${r.name},${r.results.filter(x=>x.correct).length}/${r.results.length}`).join('\n');
                const a = document.createElement('a');
                a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                a.download = 'notas.csv'; a.click();
            };

            // --- L√ìGICA DE LOGIN CON CONTRASE√ëA ---
            const handleStudentLogin = () => {
                if(!studentName) return alert('Escribe tu nombre');
                // Verificaci√≥n de contrase√±a
                if(inputStudentPass.toUpperCase() !== STUDENT_PASSWORD.toUpperCase()) {
                    return alert('‚ö†Ô∏è C√≥digo de sesi√≥n incorrecto. Solic√≠talo al profesor.');
                }
                setView('exam');
            };

            // --- VISTAS ---
            if(view === 'login') {
                return (
                    <div className="login-screen">
                        <div className="login-card">
                            <h2 style={{textAlign:'center', marginBottom:'20px'}}>üîê Acceso Restringido</h2>
                            
                            <label className="label">Nombre del Estudiante</label>
                            <input className="input" placeholder="Nombre y Apellido" value={studentName} onChange={e=>setStudentName(e.target.value)} />
                            
                            <label className="label" style={{marginTop:'10px'}}>C√≥digo de la Sesi√≥n</label>
                            <input className="input" placeholder="C√≥digo dado por el profesor" value={inputStudentPass} onChange={e=>setInputStudentPass(e.target.value)} />
                            
                            <button className="btn btn-primary" style={{width:'100%', justifyContent:'center', marginTop:'15px'}} onClick={handleStudentLogin}>Ingresar al Examen</button>
                            
                            <div style={{margin:'20px 0', borderTop:'1px solid #e2e8f0'}}></div>
                            
                            <label className="label">Profesor</label>
                            <input type="password" className="input" placeholder="Contrase√±a Admin" value={adminPassword} onChange={e=>setAdminPassword(e.target.value)} />
                            <button className="btn btn-secondary" style={{width:'100%', justifyContent:'center'}} onClick={()=>{if(adminPassword==='profesor123') setView('admin'); else alert('Incorrecto');}}>Panel Profesor</button>
                        </div>
                    </div>
                );
            }

            if(view === 'admin') {
                return (
                    <div className="container">
                        <div className="card">
                            <div style={{display:'flex', justifyContent:'space-between', marginBottom:'20px'}}>
                                <h1>üë®‚Äçüè´ Panel Profesor</h1>
                                <button className="btn btn-gray" onClick={()=>setView('login')}>Salir</button>
                            </div>
                            
                            <div style={{background:'#e0f2fe', padding:'15px', borderRadius:'8px', marginBottom:'20px', border:'1px solid #bae6fd', color:'#0369a1'}}>
                                üîë <strong>C√≥digo actual para alumnos:</strong> <span style={{fontSize:'1.2em', fontWeight:'bold'}}>{STUDENT_PASSWORD}</span>
                            </div>

                            {!editMode ? (
                                <div>
                                    <div style={{display:'flex', gap:'10px', marginBottom:'20px', flexWrap:'wrap'}}>
                                        <button className="btn btn-primary" onClick={()=>setEditMode(true)}>‚úèÔ∏è Editar</button>
                                        <button className="btn btn-success" onClick={downloadCSV}>üì• Excel</button>
                                        <button className="btn btn-danger" onClick={clearData}>üóëÔ∏è Borrar</button>
                                    </div>
                                    <table className="table">
                                        <thead><tr><th>Alumno</th><th>Nota</th></tr></thead>
                                        <tbody>
                                            {studentResults.map((r,i) => {
                                                const hits = r.results.filter(x=>x.correct).length;
                                                return <tr key={i}><td>{r.name}</td><td><span className={`badge ${hits>=Math.ceil(questions.length/2)?'badge-green':'badge-red'}`}>{hits}/{r.results.length}</span></td></tr>
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div>
                                    <p>Edici√≥n activada...</p>
                                    <div className="edit-section"><div className="edit-title">1. Caso</div><input className="input" value={caseData.title} onChange={e=>setCaseData({...caseData, title:e.target.value})} /><textarea className="textarea" rows="6" value={caseData.content} onChange={e=>setCaseData({...caseData, content:e.target.value})} /></div>
                                    <div className="edit-section"><div className="edit-title">2. Preguntas</div>{questions.map((q,i)=><div key={q.id} className="question-editor"><div className="question-editor-header">P{i+1}</div><input className="input" value={q.question} onChange={e=>updateQ(q.id,'question',e.target.value)}/></div>)}</div>
                                    <div style={{display:'flex', justifyContent:'flex-end', gap:'10px'}}><button className="btn btn-outline" onClick={restoreDefaults}>Restaurar</button><button className="btn btn-success" onClick={saveChanges}>Guardar</button></div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if(view === 'exam') {
                if(submitted) {
                    const lastResult = studentResults[studentResults.length - 1];
                    const hits = lastResult.results.filter(x=>x.correct).length;
                    return (
                        <div className="container"><div className="card" style={{textAlign:'center'}}><h1>Resultados: {hits}/{questions.length}</h1>
                        <div style={{textAlign:'left', marginTop:'30px'}}>{lastResult.results.map((r,i)=><div key={i} className="question-card" style={{borderColor:r.correct?'#86efac':'#fca5a5'}}><p><strong>{i+1}. {r.question}</strong></p><p>Tu respuesta: {r.userAnswer.toString()}</p>{r.correct?<p className="correct-answer">¬°Correcto!</p>:<p className="wrong-answer">Incorrecto. {r.feedback}</p>}</div>)}</div>
                        <button className="btn btn-primary" onClick={()=>setView('login')}>Salir</button></div></div>
                    );
                }
                return (
                    <div className="container"><div className="card"><h2 style={{color:'#2563eb', marginBottom:'15px'}}>{caseData.title}</h2><div className="case-content">{caseData.content}</div><h3>Cuestionario</h3>{questions.map((q,i)=><div key={q.id} className="question-card"><p style={{fontWeight:'bold'}}>{i+1}. {q.question}</p>
                    {q.type==='multiple'&&q.options.map((opt,idx)=><label key={idx} className="option-label"><input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers,[q.id]:idx})}/> {opt}</label>)}
                    {q.type==='truefalse'&&<><label className="option-label"><input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers,[q.id]:true})}/> V</label><label className="option-label"><input type="radio" name={`q${q.id}`} onChange={()=>setAnswers({...answers,[q.id]:false})}/> F</label></>}
                    {q.type==='short'&&<textarea className="textarea" rows="2" onChange={e=>setAnswers({...answers,[q.id]:e.target.value})} placeholder="Respuesta..."/>}
                    </div>)}<button className="btn btn-success" style={{width:'100%'}} onClick={submitExam}>Enviar</button></div></div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
