<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti칩n de las Relaciones en las Organizaciones</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; background: #f9fafb; }
        .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 32px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 16px; }
        .btn:hover { transform: scale(1.05); }
        .btn-primary { background: linear-gradient(135deg, #2563eb, #06b6d4); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #9333ea, #ec4899); color: white; }
        .btn-success { background: linear-gradient(135deg, #16a34a, #2563eb); color: white; }
        .btn-gray { background: #6b7280; color: white; }
        .btn-green { background: #16a34a; color: white; }
        .btn-blue { background: #2563eb; color: white; }
        .input { width: 100%; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 16px; margin-bottom: 8px; }
        .textarea { width: 100%; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 16px; resize: vertical; margin-bottom: 8px;}
        .login-screen { min-height: 100vh; background: linear-gradient(135deg, #9333ea, #2563eb, #06b6d4); display: flex; align-items: center; justify-content: center; padding: 24px; }
        .login-card { max-width: 450px; width: 100%; }
        .title { font-size: 28px; font-weight: 700; text-align: center; margin-bottom: 8px; color: #1f2937; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 32px; }
        .label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px; }
        .divider { text-align: center; margin: 24px 0; position: relative; }
        .divider::before { content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #d1d5db; }
        .divider span { position: relative; background: white; padding: 0 12px; color: #6b7280; }
        .screen-bg { min-height: 100vh; background: #f9fafb; padding: 24px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
        .header-title { font-size: 28px; font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 8px; }
        .button-group { display: flex; gap: 12px; flex-wrap: wrap; }
        .table { width: 100%; border-collapse: collapse; margin-top: 24px; }
        .table thead { background: #f3f4f6; }
        .table th, .table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 9999px; font-size: 12px; font-weight: 600; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .case-box { background: linear-gradient(135deg, #f3e8ff, #dbeafe); padding: 24px; border-radius: 12px; margin-bottom: 32px; }
        .case-title { font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 16px; }
        .case-content { color: #374151; line-height: 1.75; white-space: pre-line; }
        .question-box { background: #f9fafb; padding: 24px; border-radius: 12px; border-left: 4px solid #2563eb; margin-bottom: 24px; }
        .result-box { background: linear-gradient(135deg, #3b82f6, #9333ea); color: white; padding: 32px; border-radius: 12px; text-align: center; margin-bottom: 32px; }
        .answer-box { padding: 24px; border-radius: 12px; border-left: 4px solid; margin-bottom: 24px; }
        .answer-correct { background: #f0fdf4; border-color: #16a34a; }
        .answer-incorrect { background: #fef2f2; border-color: #dc2626; }
        .status-correct { background: #bbf7d0; color: #166534; padding: 4px 12px; border-radius: 9999px; font-size: 12px; font-weight: 700; }
        .status-incorrect { background: #fecaca; color: #991b1b; padding: 4px 12px; border-radius: 9999px; font-size: 12px; font-weight: 700; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .space-y { display: flex; flex-direction: column; gap: 16px; }
        
        /* Error handler style */
        #error-display { padding: 20px; background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; border-radius: 8px; margin: 20px; display: none; }
    </style>
    
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            if (display) {
                display.style.display = 'block';
                display.innerHTML = '<strong>丘멆잺 Error detectado:</strong><br>' + message + '<br><small>L칤nea: ' + lineno + '</small>';
            }
        };
    </script>
</head>
<body>
    <div id="error-display"></div>
    
    <div id="root"></div>
    
    <script type="text/babel">
        // Aseguramos que React est칠 disponible
        const { useState, useEffect } = React;
        
        // Iconos SVG como componentes
        const Download = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{verticalAlign: 'middle'}}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>);
        const Edit2 = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{verticalAlign: 'middle'}}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>);
        const X = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{verticalAlign: 'middle'}}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);
        const Users = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{verticalAlign: 'middle'}}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
        const BarChart3 = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{verticalAlign: 'middle'}}><path d="M3 3v18h18"/><rect x="7" y="12" width="3" height="9"/><rect x="14" y="8" width="3" height="13"/></svg>);

        // Sistema de almacenamiento seguro
        const storage = {
            get: (key) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? { value: item } : null;
                } catch (e) { return null; }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                } catch (e) { console.error(e); }
            }
        };

        const App = () => {
            const [view, setView] = useState('login');
            const [studentName, setStudentName] = useState('');
            const [currentStudent, setCurrentStudent] = useState(null);
            const [answers, setAnswers] = useState({});
            const [submitted, setSubmitted] = useState(false);
            const [results, setResults] = useState(null);
            const [editMode, setEditMode] = useState(false);
            const [studentResults, setStudentResults] = useState([]);
            const [professorPassword, setProfessorPassword] = useState('');
            const [showPasswordInput, setShowPasswordInput] = useState(false);
            
            // --- CONFIGURACI칍N ---
            const PROFESSOR_PASSWORD = 'profesor123';
            
            // Estado del Caso
            const [caseData, setCaseData] = useState({
                title: "Caso: Choque Generacional en Log칤stica Andina",
                content: "Log칤stica y Distribuci칩n Andina S.A. es una empresa tradicional de repuestos con 120 empleados. Ante una oportunidad de venta clave con una minera, surge un conflicto cr칤tico.\n\nRoberto, el Gerente Comercial (58 a침os), insiste en realizar un viaje de tres d칤as para una visita presencial y almuerzo, defendiendo el 'trato humano' y la jerarqu칤a. Por otro lado, Camila, la nueva Analista Digital (25 a침os), propone cancelar el viaje por ineficiente y realizar una demo virtual, bas치ndose en que el cliente es un perfil joven y tecnol칩gico.\n\nLa discusi칩n en la junta escala a ofensas personales: Camila tilda los m칠todos de Roberto de 'obsoletos' y Roberto la acusa de 'falta de respeto' y arrogancia. El Director General debe intervenir para asegurar la venta y evitar una fractura en el equipo comercial."
            });

            // Preguntas
            const [questions] = useState([
                { 
                    id: 1, 
                    type: 'multiple', 
                    question: '쮺u치l es la ra칤z principal del conflicto entre Roberto y Camila?', 
                    options: ['Disputa por el presupuesto de vi치ticos', 'Choque de paradigmas generacionales sobre c칩mo hacer negocios', 'Competencia por el puesto de Gerente Comercial', 'Falta de herramientas tecnol칩gicas en la empresa'], 
                    correct: 1, 
                    feedback: 'El conflicto no es solo t칠cnico, sino un choque de visiones: Roberto valora la relaci칩n personal y la tradici칩n, mientras que Camila prioriza la eficiencia y la digitalizaci칩n.' 
                },
                { 
                    id: 2, 
                    type: 'truefalse', 
                    question: 'Dar la raz칩n completamente a uno de los dos es la estrategia m치s efectiva para el largo plazo.', 
                    correct: false, 
                    feedback: 'Falso. Validar solo a uno alienar칤a a la otra parte (fuga de talento joven o desmotivaci칩n del senior). La soluci칩n ideal debe integrar ambas visiones.' 
                },
                { 
                    id: 3, 
                    type: 'short', 
                    question: 'Menciona una t칠cnica de gesti칩n para que ambos empleados aprendan del otro.', 
                    correctAnswers: ['mentoring inverso', 'mentoria inversa', 'mentor칤a inversa', 'trabajo en pares', 'equipos mixtos'], 
                    feedback: 'El "Mentoring Inverso" es ideal: Camila ense침a herramientas digitales a Roberto, y Roberto ense침a negociaci칩n y habilidades relacionales a Camila.' 
                },
                { 
                    id: 4, 
                    type: 'multiple', 
                    question: '쯈u칠 error de comunicaci칩n cometi칩 Camila al presentar su propuesta?', 
                    options: ['No tener los datos a mano', 'Usar un lenguaje t칠cnico incomprensible', 'Invalidar la experiencia de Roberto llam치ndola "ineficiente" y "vieja"', 'Proponer una soluci칩n demasiado costosa'], 
                    correct: 2, 
                    feedback: 'Aunque sus datos eran correctos, Camila fall칩 en las habilidades blandas al atacar la identidad profesional de Roberto en lugar de complementar su propuesta.' 
                },
                { 
                    id: 5, 
                    type: 'truefalse', 
                    question: 'En el contexto latinoamericano del caso, el "capital relacional" de Roberto sigue siendo un activo valioso.', 
                    correct: true, 
                    feedback: 'Verdadero. En la cultura de negocios regional, la confianza personal y las redes de contacto (que Roberto posee) siguen siendo determinantes para cerrar grandes contratos.' 
                }
            ]);

            useEffect(() => {
                const load = () => {
                    const saved = storage.get('student-results');
                    if (saved) setStudentResults(JSON.parse(saved.value));
                };
                load();
            }, []);

            const saveResult = (studentName, answers, results) => {
                const newResult = { name: studentName, date: new Date().toISOString(), answers, results };
                const updatedResults = [...studentResults, newResult];
                setStudentResults(updatedResults);
                storage.set('student-results', JSON.stringify(updatedResults));
            };

            const handleLogin = (type) => {
                if (type === 'student' && !studentName.trim()) return alert('Ingresa tu nombre');
                if (type === 'student') {
                    setCurrentStudent(studentName);
                    setView('case');
                } else {
                    setShowPasswordInput(true);
                }
            };

            const handleProfessorLogin = () => {
                if (professorPassword === PROFESSOR_PASSWORD) {
                    setView('professor');
                    setProfessorPassword('');
                    setShowPasswordInput(false);
                } else {
                    alert('Contrase침a incorrecta');
                }
            };

            const checkAnswer = (q, ans) => {
                if (q.type === 'multiple' || q.type === 'truefalse') return ans === q.correct;
                if (q.type === 'short') {
                    if (!ans) return false;
                    return q.correctAnswers.some(c => ans.toLowerCase().includes(c.toLowerCase()));
                }
                return false;
            };

            const handleSubmit = () => {
                if (questions.some(q => answers[q.id] === undefined)) return alert('Responde todo antes de enviar');
                
                const calcs = questions.map(q => ({
                    question: q.question,
                    userAnswer: answers[q.id],
                    correct: checkAnswer(q, answers[q.id]),
                    feedback: q.feedback,
                    correctAnswer: q.type === 'multiple' ? q.options[q.correct] : (q.type === 'truefalse' ? (q.correct ? 'Verdadero' : 'Falso') : q.correctAnswers.join(', '))
                }));
                
                setResults(calcs);
                setSubmitted(true);
                saveResult(currentStudent, answers, calcs);
            };

            const exportResults = () => {
                const csvContent = [
                    ['Nombre', 'Fecha', 'Correctas', 'Total'],
                    ...studentResults.map(r => [
                        r.name, 
                        new Date(r.date).toLocaleDateString(), 
                        r.results.filter(x => x.correct).length, 
                        r.results.length
                    ])
                ].map(e => e.join(",")).join("\n");
                
                const link = document.createElement("a");
                link.setAttribute("href", "data:text/csv;charset=utf-8," + encodeURI(csvContent));
                link.setAttribute("download", "resultados.csv");
                document.body.appendChild(link);
                link.click();
            };

            const reset = () => {
                setView('login');
                setStudentName('');
                setCurrentStudent(null);
                setAnswers({});
                setSubmitted(false);
                setResults(null);
                setShowPasswordInput(false);
            };

            // VISTAS
            if (view === 'login') {
                return (
                    <div className="login-screen">
                        <div className="card login-card">
                            <h1 className="title">Gesti칩n de Relaciones</h1>
                            <p className="subtitle">An치lisis de Caso</p>
                            <div className="space-y">
                                {!showPasswordInput ? (
                                    <>
                                        <input type="text" value={studentName} onChange={e => setStudentName(e.target.value)} placeholder="Tu nombre completo" className="input" />
                                        <button onClick={() => handleLogin('student')} className="btn btn-primary" style={{width: '100%'}}>Entrar como Alumno</button>
                                        <div className="divider"><span>o</span></div>
                                        <button onClick={() => handleLogin('professor')} className="btn btn-secondary" style={{width: '100%', display: 'flex', justifyContent: 'center', gap: '8px'}}><Users/> Soy Profesor</button>
                                    </>
                                ) : (
                                    <>
                                        <input type="password" value={professorPassword} onChange={e => setProfessorPassword(e.target.value)} placeholder="Contrase침a" className="input" />
                                        <button onClick={handleProfessorLogin} className="btn btn-secondary" style={{width: '100%'}}>Acceder</button>
                                        <button onClick={() => setShowPasswordInput(false)} className="btn btn-gray" style={{width: '100%'}}>Cancelar</button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'professor') {
                return (
                    <div className="screen-bg">
                        <div className="container">
                            <div className="card">
                                <div className="header">
                                    <h1 className="header-title"><BarChart3/> Panel Profesor</h1>
                                    <div className="button-group">
                                        <button onClick={() => setEditMode(!editMode)} className="btn btn-blue" style={{display:'flex', gap:'8px'}}>{editMode ? <X/> : <Edit2/>} {editMode ? 'Cancelar' : 'Editar Caso'}</button>
                                        <button onClick={exportResults} className="btn btn-green" disabled={!studentResults.length} style={{display:'flex', gap:'8px'}}><Download/> Exportar CSV</button>
                                        <button onClick={reset} className="btn btn-gray">Salir</button>
                                    </div>
                                </div>
                                {editMode ? (
                                    <div className="space-y">
                                        <input value={caseData.title} onChange={e => setCaseData({...caseData, title: e.target.value})} className="input"/>
                                        <textarea value={caseData.content} onChange={e => setCaseData({...caseData, content: e.target.value})} rows={10} className="textarea"/>
                                        <div style={{background:'#eff6ff', padding:'12px', borderRadius:'8px', color:'#1e40af'}}>Cambios guardados temporalmente (se perder치n al recargar).</div>
                                    </div>
                                ) : (
                                    <div style={{overflowX: 'auto'}}>
                                        <p style={{marginBottom: '16px', fontWeight: 'bold'}}>Respuestas recibidas: {studentResults.length}</p>
                                        <table className="table">
                                            <thead>
                                                <tr><th>Alumno</th><th>Fecha</th><th>Aciertos</th></tr>
                                            </thead>
                                            <tbody>
                                                {studentResults.map((r, i) => (
                                                    <tr key={i}>
                                                        <td>{r.name}</td>
                                                        <td>{new Date(r.date).toLocaleTimeString()}</td>
                                                        <td><span className="badge badge-blue">{r.results.filter(x=>x.correct).length}/{r.results.length}</span></td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {studentResults.length === 0 && <div style={{textAlign:'center', padding:'32px', color:'#6b7280'}}>Esperando alumnos...</div>}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'case') {
                if (submitted && results) {
                    const corrects = results.filter(r => r.correct).length;
                    return (
                        <div className="screen-bg">
                            <div className="container">
                                <div className="card">
                                    <h1 className="title">Resultados</h1>
                                    <div className="result-box">
                                        <p style={{fontSize:'48px', fontWeight:'bold'}}>{corrects} / {results.length}</p>
                                        <p>Aciertos</p>
                                    </div>
                                    <div className="space-y">
                                        {results.map((r, i) => (
                                            <div key={i} className={`answer-box ${r.correct ? 'answer-correct' : 'answer-incorrect'}`}>
                                                <div className="flex-between" style={{marginBottom:'10px'}}>
                                                    <strong>{i+1}. {r.question}</strong>
                                                    <span className={r.correct ? 'status-correct' : 'status-incorrect'}>{r.correct ? 'Correcto' : 'Incorrecto'}</span>
                                                </div>
                                                <p>Tu respuesta: {r.userAnswer.toString()}</p>
                                                {!r.correct && <p>Correcta: {r.correctAnswer}</p>}
                                                <p style={{marginTop:'8px', fontStyle:'italic', color:'#4b5563'}}>游눠 {r.feedback}</p>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={reset} className="btn btn-primary" style={{width:'100%', marginTop:'24px'}}>Finalizar</button>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="screen-bg">
                        <div className="container">
                            <div className="card">
                                <div className="flex-between" style={{marginBottom:'24px'}}>
                                    <div>
                                        <div style={{fontSize:'12px', color:'#9333ea', fontWeight:'bold'}}>Alumno</div>
                                        <div style={{fontSize:'18px', fontWeight:'bold'}}>{currentStudent}</div>
                                    </div>
                                    <button onClick={reset} className="btn btn-gray">Salir</button>
                                </div>
                                <div className="case-box">
                                    <h2 className="case-title">{caseData.title}</h2>
                                    <p className="case-content">{caseData.content}</p>
                                </div>
                                <div className="space-y">
                                    {questions.map((q, i) => (
                                        <div key={q.id} className="question-box">
                                            <p style={{fontWeight:'bold', marginBottom:'12px'}}>{i+1}. {q.question}</p>
                                            {q.type === 'short' ? (
                                                <textarea className="textarea" rows={3} onChange={e => setAnswers({...answers, [q.id]: e.target.value})} placeholder="Escribe tu respuesta..."></textarea>
                                            ) : (
                                                <div className="space-y" style={{gap:'8px'}}>
                                                    {(q.type === 'multiple' ? q.options : [true, false]).map((opt, idx) => {
                                                        const val = q.type === 'multiple' ? idx : opt;
                                                        const label = q.type === 'multiple' ? opt : (opt ? 'Verdadero' : 'Falso');
                                                        return (
                                                            <label key={idx} style={{display:'flex', alignItems:'center', gap:'10px', padding:'10px', background:'white', borderRadius:'8px', cursor:'pointer'}}>
                                                                <input type="radio" name={`q${q.id}`} onChange={() => setAnswers({...answers, [q.id]: val})} />
                                                                <span>{label}</span>
                                                            </label>
                                                        )
                                                    })}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                    <button onClick={handleSubmit} className="btn btn-success" style={{width:'100%', padding:'16px'}}>Enviar Examen</button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
            return null;
        };

        // --- RENDERIZADO REACT 18 ---
        try {
            const container = document.getElementById('root');
            const root = ReactDOM.createRoot(container);
            root.render(<App />);
        } catch (error) {
            document.getElementById('error-display').style.display = 'block';
            document.getElementById('error-display').innerHTML = 'Error cr칤tico al iniciar la App: ' + error.message;
        }
    </script>
</body>
</html>
